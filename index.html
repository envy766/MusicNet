<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MusicNet ‚Äî Music Player</title>
<style>
  :root{
    --bg1:#05060a; --bg2:#071033;
    --neon1:#6ef0ff; --neon2:#8a4fff;
    --card:#071028aa; --muted:#9aa3bf;
    --glass: rgba(255,255,255,0.04);
  }
  *{box-sizing:border-box}
html,body{
  height:100%;
  margin:0;
  font-family:Inter, "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue";
  background:
    radial-gradient(800px 600px at 10% 10%, rgba(106,57,255,0.08), transparent),
    linear-gradient(180deg,var(--bg1),var(--bg2));
  color:#e6eef8;
  display:flex;
  align-items:center;
  justify-content:center;
}

.wrap{
  width:100%;
  min-height:100vh;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding:28px;
  overflow-y:auto;
}

.player{
  margin-top: 90px;
  width:100%;
  max-width:1120px;
  border-radius:18px;
  padding:20px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  box-shadow: 0 10px 40px rgba(7,10,30,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
  display:grid;
  grid-template-columns: 300px 1fr 300px;
  gap:18px;
  align-items:center;
  backdrop-filter: blur(8px);
}

  /* left: cover */
  .cover {
    width:100%; border-radius:14px; overflow:hidden; min-height:300px; position:relative;
    background: linear-gradient(135deg, rgba(106,57,255,0.12), rgba(110,240,255,0.06));
    display:flex; align-items:center; justify-content:center;
  }
  .cover img{width:100%; height:100%; object-fit:cover; display:block;}
  .cover .fallback {
    display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; padding:18px;
  }
  .cover .fallback .logo {
    width:110px; height:110px; border-radius:18px; background:linear-gradient(135deg,var(--neon1),var(--neon2));
    box-shadow: 0 8px 30px rgba(138,79,255,0.18);
    display:flex; align-items:center; justify-content:center; font-weight:700; color:#021024; font-size:22px;
  }

  /* center: controls & info */
  .center {
    padding:8px 6px;
  }
  .meta {
    display:flex; flex-direction:column; gap:6px; margin-bottom:12px;
  }
  .title { font-size:1.1rem; font-weight:700; letter-spacing:0.2px; }
  .artist { color:var(--muted); font-size:0.9rem; margin-top:4px; }

  .controls {
    display:flex; gap:10px; align-items:center; justify-content:flex-start; margin-top:12px;
  }
  .big {
    width:56px; height:56px; border-radius:50%; display:grid; place-items:center; cursor:pointer;
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.04);
    transition: transform .15s ease, box-shadow .15s;
  }
  .big:active{ transform: scale(.98); }
  .btn {
    padding:10px 14px; border-radius:12px; cursor:pointer;
    background:transparent; border:1px solid rgba(255,255,255,0.04);
    color:var(--neon1); display:inline-flex; gap:8px; align-items:center;
  }

  /* progress */
  .progressWrap { margin-top:18px; display:flex; gap:12px; align-items:center; }
  .time { font-size:0.82rem; color:var(--muted); width:44px; text-align:center;}
  .progress {
    flex:1; height:8px; border-radius:999px; background:rgba(255,255,255,0.03); position:relative; cursor:pointer;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
  }
  .progress .bar {
    height:100%; width:0%; border-radius:999px; background: linear-gradient(90deg,var(--neon1),var(--neon2));
    box-shadow: 0 6px 20px rgba(110,240,255,0.12);
  }

  /* right: playlist + visualizer */
  .right { padding:8px; display:flex; flex-direction:column; gap:12px; align-items:stretch; }
  .playlist {
    background:var(--glass); padding:8px; border-radius:12px; max-height:300px; overflow-y:auto;
    border:1px solid rgba(255,255,255,0.02);
  }
  .song {
    padding:10px; border-radius:8px; display:flex; align-items:center; gap:10px; cursor:pointer;
  transition: background 0.25s ease, box-shadow 0.25s ease;
  }
  .song:hover { background: rgba(110,240,255,0.2); }
  .song.active { background: linear-gradient(90deg, rgba(110,240,255,0.3), rgba(138,79,255,0.3)); box-shadow: 0 0 17px rgba(110,240,255,0.4);
  }
  .song .smeta { font-size:0.95rem; font-weight:600; }
  .song .ssub { font-size:0.82rem; color:var(--muted); }

  .visual {
    height:120px; border-radius:10px; background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
    display:flex; align-items:center; justify-content:center; gap:6px; padding:10px;
    border:1px solid rgba(255,255,255,0.02);
  }
  .barVis { width:6px; background:var(--neon1); border-radius:4px; height:10px; opacity:0.9; transition:height .08s linear; }

  /* footer small helpers */
  .opts { display:flex; gap:8px; align-items:center; margin-top:6px; }
  .small { font-size:0.85rem; color:var(--muted) }

  /* responsive */
  @media(max-width:900px){
    .player{grid-template-columns: 1fr; padding:16px;}
    .cover{min-height:220px}
    .right{order:3}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="player" role="application" aria-label="MusicNet Player">
    <!-- COVER -->
    <div class="cover" id="cover">
      <!-- if cover.jpg exists it will be loaded here by JS -->
      <div class="fallback">
        <div class="logo">MN</div>
        <div style="color:var(--muted); font-size:0.9rem">MUSIC NET</div>
      </div>
    </div>

    <!-- CENTER: INFO + CONTROLS -->
    <div class="center">
      <div class="meta">
        <div class="title" id="title">‚Äî</div>
        <div class="artist" id="artist">‚Äî</div>
      </div>

      <div class="controls">
        <div class="big" id="prev" title="Previous">‚èÆ</div>
        <div class="big" id="play" title="Play / Pause">‚ñ∂Ô∏è</div>
        <div class="big" id="next" title="Next">‚è≠</div>
        <button class="btn" id="shuffle" title="Shuffle">üîÄ Shuffle</button>
        <button class="btn" id="repeat" title="Repeat">üîÅ Off</button>
      </div>

      <div class="progressWrap">
        <div class="time" id="cur">0:00</div>
        <div class="progress" id="progress" title="Seek">
          <div class="bar" id="bar"></div>
        </div>
        <div class="time" id="dur">0:00</div>
      </div>

      <div style="display:flex; align-items:center; justify-content:space-between; margin-top:12px">
        <div class="opts">
          <div class="small">VOL</div>
          <input type="range" id="vol" min="0" max="1" step="0.01" style="width:140px">
          <button class="btn" id="mute">üîà</button>
        </div>
        <div class="small" id="status">Ready</div>
      </div>
    </div>

    <!-- RIGHT: PLAYLIST + VISUALIZER -->
    <div class="right">
      <div class="playlist" id="playlist" aria-live="polite">
        <!-- song items will be injected here -->
      </div>

      <div class="visual" id="visual">
        <!-- bars -->
      </div>

      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div class="small"> ¬∞¬∞ <strong> AFRIZAL </strong> ¬∞¬∞ </div>
       <div><button class="btn" id="toggleList">Hide/Show</button></div>
      </div>
    </div>
  </div>
</div>

<!-- Audio element hidden -->
<audio id="audio" crossorigin="anonymous"></audio>

<script>
/* =========================
   CONFIG
   ========================= */
const singleTrack = {
  file: "Mylist/Christina Perri - A Thousand Years (Remake) [slow].mp3",
  title: "Christina Perri ‚Äî A Thousand Years (Remake)",
  artist: ""
};
// If playlist.json exists in same folder, it should be an array of objects:
// [{ "file": "Mylist/song.mp3", "title": "Title", "artist": "Artist" }, ...]
const playlistURL = "playlist.json";

/* =========================
   APP STATE
   ========================= */
let playlist = [];
let idx = 0;
let isShuffle = false;
let repeatMode = 0; // 0 = off, 1 = repeat all, 2 = repeat one

/* =========================
   DOM refs
   ========================= */
const audio = document.getElementById('audio');
const titleEl = document.getElementById('title');
const artistEl = document.getElementById('artist');
const playBtn = document.getElementById('play');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const shuffleBtn = document.getElementById('shuffle');
const repeatBtn = document.getElementById('repeat');
const curEl = document.getElementById('cur');
const durEl = document.getElementById('dur');
const progress = document.getElementById('progress');
const bar = document.getElementById('bar');
const playlistEl = document.getElementById('playlist');
const vol = document.getElementById('vol');
const muteBtn = document.getElementById('mute');
const status = document.getElementById('status');
const cover = document.getElementById('cover');
const visual = document.getElementById('visual');
const toggleList = document.getElementById('toggleList');

/* =========================
   UTIL
   ========================= */
function fmt(s){
  if (!isFinite(s)) return "0:00";
  const m = Math.floor(s/60), sec = Math.floor(s%60).toString().padStart(2,'0');
  return `${m}:${sec}`;
}
function safeSetText(el, txt){ el.textContent = txt || "‚Äî"; }

/* =========================
   LOAD playlist.json or fallback
   ========================= */
async function loadPlaylist(){
  try{
    const res = await fetch(playlistURL, {cache:'no-store'});
    if (!res.ok) throw new Error("no playlist.json");
    const data = await res.json();
    if (!Array.isArray(data) || data.length === 0) throw new Error("empty playlist");
    playlist = data;
    status.textContent = `Loaded ${playlist.length} songs`;
  }catch(e){
    // fallback single track
    playlist = [singleTrack];
    status.textContent = "Using single fallback track";
  }
  renderPlaylist();
  loadTrack(0, false);
}

/* =========================
   RENDER playlist
   ========================= */
function renderPlaylist(){
  playlistEl.innerHTML = "";
  playlist.forEach((s,i)=>{
    const div = document.createElement('div');
    div.className = 'song';
    div.dataset.i = i;
    if (i === idx) div.classList.add('active');
    const sm = document.createElement('div');
    sm.style.flex = '1';
    const t = document.createElement('div'); t.className='smeta'; t.textContent = s.title || `Track ${i+1}`;
    const su = document.createElement('div'); su.className='ssub'; su.textContent = s.artist || '';
    sm.appendChild(t); sm.appendChild(su);
    div.appendChild(sm);
    div.addEventListener('click', ()=>{ loadTrack(i, true); });
    playlistEl.appendChild(div);
  });
}

/* =========================
   LOAD track
   ========================= */
  function loadTrack(i, autoplay=false){
  idx = i;
  const tr = playlist[i];
  audio.src = tr.file;
  
  // update info judul
  title.textContent = tr.title;
  artist.textContent = tr.artist || '';
  cover.querySelector('.logo').textContent = tr.title.slice(0,2).toUpperCase();

  // aktifkan tombol play/pause
  playBtn.textContent = '‚ñ∂Ô∏è';

  // tandai lagu aktif di playlist
  document.querySelectorAll('.song').forEach((el, j)=>{
    el.classList.toggle('active', j === i);
  });

  if (autoplay) audio.play();  // <--- pastikan lagu langsung main saat di-load
}
  safeSetText(titleEl, item.title || item.file);
  safeSetText(artistEl, item.artist || "");
  updateActive();
  try{ // try load cover.jpg automatically if present
    const coverUrl = 'cover.jpg';
    fetch(coverUrl, {method:'HEAD'}).then(r=>{
      if (r.ok){
        cover.innerHTML = `<img src="${coverUrl}" alt="cover">`;
      } else {
        // fallback UI already present
      }
    }).catch(()=>{});
  }catch(err){}
  if(play) {
    audio.play().catch(e=>status.textContent = "Play blocked: tap to allow");
  }
}

/* =========================
   PLAY CONTROLS
   ========================= */
// Fungsi loadTrack untuk memuat lagu
function loadTrack(i, autoplay=false) {
  if (!playlist.length) return;
  idx = (i + playlist.length) % playlist.length; // pastikan index aman
  const tr = playlist[idx];
  audio.src = tr.file;

  // update info judul dan cover
  title.textContent = tr.title;
  artist.textContent = tr.artist || '';
  cover.querySelector('.logo').textContent = tr.title.slice(0,2).toUpperCase();

  // tandai lagu aktif di playlist
  document.querySelectorAll('.song').forEach((el, j) => {
    el.classList.toggle('active', j === idx);
  });

  if (autoplay) audio.play(); // auto-play jika diminta
}

// Tombol Play/Pause
playBtn.addEventListener('click', () => {
  if (audio.paused) audio.play().catch(()=> status.textContent = "Tap play to start audio");
  else audio.pause();
});

// Ganti ikon otomatis saat status berubah
audio.addEventListener('play', () => playBtn.textContent = '‚è∏Ô∏è');
audio.addEventListener('pause', () => playBtn.textContent = '‚ñ∂Ô∏è');
audio.addEventListener('ended', () => playBtn.textContent = '‚ñ∂Ô∏è');

// Tombol prev/next
prevBtn.addEventListener('click', () => {
  if (audio.currentTime > 3) audio.currentTime = 0;
  else loadTrack(idx - 1, true);
});
nextBtn.addEventListener('click', () => nextTrack());

// Shuffle & Repeat
shuffleBtn.addEventListener('click', () => {
  isShuffle = !isShuffle;
  shuffleBtn.style.opacity = isShuffle ? 1 : 0.8;
  shuffleBtn.textContent = isShuffle ? 'üîÄ On' : 'üîÄ Shuffle';
});
repeatBtn.addEventListener('click', () => {
  repeatMode = (repeatMode + 1) % 3;
  repeatBtn.textContent = repeatMode === 0 ? 'üîÅ Off' :
                         repeatMode === 1 ? 'üîÅ All' : 'üîÅ One';
});

/* =========================
   PROGRESS & SEEK
   ========================= */
audio.addEventListener('timeupdate', ()=>{
  curEl.textContent = fmt(audio.currentTime);
  if (audio.duration) {
    const p = (audio.currentTime / audio.duration) * 100;
    bar.style.width = p + '%';
    durEl.textContent = fmt(audio.duration);
  }
});
let seeking = false;
progress.addEventListener('pointerdown', (e) => {
  seekTo(e);
  seeking = true;
  window.addEventListener('pointermove', seekTo);
});
window.addEventListener('pointerup', ()=>{
  if (seeking) window.removeEventListener('pointermove', seekTo);
  seeking = false;
});
function seekTo(e){
  const rect = progress.getBoundingClientRect();
  let x = e.clientX - rect.left;
  x = Math.max(0, Math.min(rect.width, x));
  const pct = x/rect.width;
  if (audio.duration) audio.currentTime = pct * audio.duration;
  bar.style.width = (pct*100) + '%';
}

/* =========================
   NEXT TRACK LOGIC
   ========================= */
function nextTrack(){
  if (repeatMode === 2) { // repeat one
    audio.currentTime = 0;
    audio.play();
    return;
  }
  if (isShuffle) {
    idx = Math.floor(Math.random() * playlist.length);
  } else {
    idx = (idx + 1) % playlist.length;
  }
  if (idx === 0 && repeatMode === 0 && audio.duration && audio.currentTime > 0) {
    // if reached end and repeat off, pause
    audio.pause();
    status.textContent = "Reached end";
    return;
  }
  loadTrack(idx, true);
}

/* =========================
   ENDED
   ========================= */
audio.addEventListener('ended', ()=>{
  nextTrack();
});

/* =========================
   VOLUME & MUTE
   ========================= */
vol.value = 0.85;
audio.volume = parseFloat(vol.value);
vol.addEventListener('input', ()=>{ audio.volume = parseFloat(vol.value); });
muteBtn.addEventListener('click', ()=> {
  audio.muted = !audio.muted;
  muteBtn.textContent = audio.muted ? 'üîá' : 'üîà';
});

/* =========================
   ACTIVE ITEM UI
   ========================= */
function updateActive(){
  document.querySelectorAll('.song').forEach(el => el.classList.remove('active'));
  const current = playlistEl.querySelector(`[data-i="${idx}"]`);
  if (current) current.classList.add('active');
}

/* =========================
   Keyboard events
   ========================= */
window.addEventListener('keydown', (e)=>{
  if (e.code === 'Space') { e.preventDefault(); playBtn.click(); }
  if (e.key === 'ArrowRight') nextBtn.click();
  if (e.key === 'ArrowLeft') prevBtn.click();
});

/* =========================
   TOGGLE PLAYLIST
   ========================= */
toggleList.addEventListener('click', ()=> {
  playlistEl.style.display = playlistEl.style.display === 'none' ? 'block' : 'none';
});

/* =========================
   VISUALIZER SETUP (Web Audio API)
   ========================= */
let audioCtx, analyser, sourceNode;
function setupVisualizer(){
  try{
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 128;
    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);

    sourceNode = audioCtx.createMediaElementSource(audio);
    sourceNode.connect(analyser);
    analyser.connect(audioCtx.destination);

    // create bars
    visual.innerHTML = '';
    const bars = [];
    for (let i=0;i<24;i++){
      const b = document.createElement('div');
      b.className = 'barVis';
      b.style.height = '6px';
      visual.appendChild(b);
      bars.push(b);
    }

    function render(){
      requestAnimationFrame(render);
      analyser.getByteFrequencyData(dataArray);
      for (let i=0;i<bars.length;i++){
        const v = dataArray[i] || 0;
        const h = Math.max(6, (v / 255) * 110);
        bars[i].style.height = h + 'px';
        bars[i].style.opacity = (v/255).toFixed(2);
      }
    }
    render();
  }catch(e){
    visual.textContent = 'Visualizer unsupported';
  }
}

// resume context on user gesture
document.addEventListener('click', function initOnce(){
  if (!audioCtx) setupVisualizer();
  document.removeEventListener('click', initOnce);
});

/* =========================
   INIT
   ========================= */
loadPlaylist();
</script>

</body>
</html>
