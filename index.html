<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MusicNet ‚Äî Playlist Player (Enhanced)</title>
<style>
:root{
  --bg1:#0f1020;
  --bg2:#0b2545;
  --accent:#6ef0ff;
  --accent2:#8a4fff;
  --accent3:#ff66cc;
  --neon:#6ef0ff;
  --glass: rgba(255,255,255,0.03);
}

/* reset & layout */
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:"Poppins",sans-serif;background:
  linear-gradient(145deg,var(--bg1),var(--bg2));color:#fff;display:flex;align-items:center;justify-content:center;}

/* canvas background full-screen */
canvas#bg{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  z-index:0;
  pointer-events:none;
}

/* page footer */
.page-footer{
  position:fixed;
  left:50%;
  bottom:18px;
  transform:translateX(-50%);
  font-size:11px;
  color:rgba(255,255,255,0.1);
  pointer-events:none;
  z-index:1;
  letter-spacing:0.4px;
  text-align: center;
  line-height: 1.4;
}
.page-footer .version {
  font-size: 9px;                /* lebih kecil */
  opacity: 0.8;                  /* sedikit lebih jelas */
  color: rgba(255, 255, 255, 0.15); /* beda tone */
  letter-spacing: 0.6px;
}

/* background watermark */
.bg-text {
  position: fixed;
  top: 10%;                 /* posisi vertikal (bisa ubah ke 50% jika ingin di tengah) */
  left: 50%;
  transform: translate(-50%);
  font-size: 60px;          /* ukuran besar */
  font-weight:1000;         /* sangat tebal */
  letter-spacing: 4px;      /* jarak antar huruf */
  color: rgba(110, 240, 255, 0.07); /* warna sinkron dengan tema biru neon tapi samar */
  text-transform: uppercase;
  pointer-events: none;     /* tidak bisa diklik */
  user-select: none;        /* tidak bisa di-select */
  z-index: 0;               /* di bawah semua elemen */
  white-space: nowrap;
  text-align: center;
}

.player {
  width: 380px;
  max-width: 95vw;
  max-height: 86vh;

  background: rgba(255, 255, 255, 0); /* full transparan */
  border: 1px solid rgba(255, 255, 255, 0.06); /* tipis, tetap ada bingkai */
  border-radius: 14px;

  padding: 14px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  position: relative;
  overflow: visible;
  overflow-x: hidden;

  box-shadow: 0 8px 30px rgba(0,0,0,0.15); /* opsional, agar container tetap terlihat */
  z-index: 2;
}

/* toolbar */
.toolbar{display:flex;gap:8px;align-items:center;}
.search{
  flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);
  background:rgba(255,255,255,0.02);color:#fff;font-size:0.88rem;
}
.icon-btn{
  padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);
  background:transparent;color:var(--neon);cursor:pointer;
}
.select-btn{
  padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);
  background:transparent;color:var(--neon);font-size:0.88rem;cursor:pointer;
  backdrop-filter: blur(4px);
}

/* genre panel */
.genre-panel{
  position:absolute;
  top:56px;
  left:16px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.04);
  padding:8px;
  border-radius:10px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  min-width:180px;
  box-shadow:0 8px 30px rgba(2,6,23,0.6);
  z-index:3;
}
.genre-chip{
  display:flex;align-items:center;gap:6px;padding:6px 8px;border-radius:999px;
  background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02);
  font-size:0.86rem;color:rgba(255,255,255,0.9);cursor:pointer;
}
.genre-chip input{accent-color:var(--accent);}

/* header: logo + visualizer */
.top {
  display:flex;flex-direction:column;align-items:center;gap:8px;
}
#logo{
  width:92px;height:92px;border-radius:50%;
  background:radial-gradient(circle,var(--accent),transparent);
  box-shadow:0 0 30px rgba(110,240,255,0.12);
  transition:transform .12s linear, box-shadow .12s linear;
  display:block;
}
#visualizer{width:100%;height:34px;display:flex;align-items:end;justify-content:center;gap:4px; padding:0 8px;}
#visualizer span{width:6px;height:8px;border-radius:3px;background:var(--accent);box-shadow:0 0 8px rgba(110,240,255,0.12);transition:height .08s linear,opacity .12s linear;}

/* track info */
.title {
  font-weight: 700;
  font-size: 1.05rem;
  text-align: center;
  line-height: 1.1;
  color: #fff;
  text-shadow:
    0 0 6px var(--accent),
    0 0 12px var(--accent),
    0 0 22px var(--accent2),
    0 0 35px var(--accent2);
  transition: text-shadow 0.3s ease, color 0.3s ease;
}

/* controls */
.controls{display:flex;align-items:center;justify-content:space-between;gap:8px}
.btn{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--neon);cursor:pointer}
.btn.active{color:#fff;text-shadow:0 0 10px var(--accent)}
.big{width:68px;height:68px;border-radius:50%;display:grid;place-items:center;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.06);font-size:26px;cursor:pointer}

/* volume/progress */
.row{display:flex;align-items:center;gap:8px}
.volume-container{display:flex;align-items:center;gap:8px;flex:1}
#volume{width:100%;accent-color:var(--accent)}
.time{font-size:0.82rem;color:rgba(255,255,255,0.72);min-width:46px;text-align:center}

/* progress bar - jalur putih tipis */
.progress {
  width: 100%;
  height: 8px;
  background-color: rgba(255, 255, 255, 0.15); /* ini jalur dasar */
  border-radius: 999px;
  position: relative;
  cursor: pointer;
  overflow: hidden;
}

/* bar progres di atas jalur */
.progress .bar {
  height: 100%;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg, var(--accent), var(--accent2));
  box-shadow: 0 6px 20px rgba(110,240,255,0.08);
  transition: width 0.1s linear;
  position: absolute;
  top: 0;
  left: 0;
}

/* playlist */
.playlist-wrap {flex: 1 1 auto;display: flex;flex-direction: column;gap: 6px;min-height: 0;}
.playlist {flex: 1 1 auto;overflow-y: auto;padding-right: 6px;border-radius: 8px;min-height: 0;}
/* WebKit (Chrome, Edge, Safari) */
.playlist::-webkit-scrollbar {width: 6px;}
.playlist::-webkit-scrollbar-thumb {background: rgba(110,240,255,0.4);border-radius: 3px;}
.playlist::-webkit-scrollbar-track {background: transparent;}
/* Firefox */
.playlist {scrollbar-width: thin;scrollbar-color: rgba(110,240,255,0.4) transparent;}
/* Mobile / iOS momentum scroll */
.playlist {-webkit-overflow-scrolling: touch;}
.item{
  padding:8px;border-radius:8px;display:flex;align-items:center;justify-content:space-between;gap:8px;
  cursor:pointer;transition:background .12s ease;}
.item:hover{background:rgba(110,240,255,0.04)}
.item .meta{flex:1;min-width:0}
.item .t{font-weight:600;font-size:0.95rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.item .a{font-size:0.78rem;color:rgba(255,255,255,0.7);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.item.active {
  background: linear-gradient(90deg, rgba(110,240,255,0.25), rgba(138,79,255,0.22));
  box-shadow:
    0 0 12px rgba(110,240,255,0.6),
    0 0 24px rgba(138,79,255,0.4);
  border: 1px solid rgba(110,240,255,0.35);
  color: #fff;
  text-shadow:
    0 0 8px rgba(110,240,255,0.8),
    0 0 16px rgba(138,79,255,0.6);
  transition: all 0.25s ease-in-out;
}

/* favorite */
.fav{font-size:1.1rem;color:rgba(255,255,255,0.45);user-select:none;padding-left:8px}
.fav.active{color:var(--accent3);text-shadow:0 0 8px var(--accent3)}

/* playback rate */
#rateDisplay{font-size:0.8rem;color:rgba(255,255,255,0.7);min-width:42px;text-align:center}

/* hide playlist */
.playlist-wrap.hidden { display: none; }

/* responsive */
@media(max-width:420px){
  .player{width:92vw;}
  #logo{width:78px;height:78px}
}
</style>
</head>
<body>
<canvas id="bg" aria-hidden="true"></canvas>

<div class="player" aria-live="polite">
  <div class="toolbar" style="position:relative;">
    <input id="search" class="search" placeholder="Cari lagu atau artis..." aria-label="Cari lagu" />
    <button id="toggleList" class="icon-btn" title="Hide/show playlist">‚ñº</button>
    <button id="favOnly" class="icon-btn" title="Tampilkan favorit">‚òÖ</button>
    <button id="genreBtn" class="select-btn" aria-haspopup="true" aria-expanded="false">Genre ‚ñº</button>
    <div id="genrePanel" class="genre-panel" style="display:none;"></div>
  </div>

  <div class="top">
    <div id="logo" aria-hidden="true"></div>
    <div id="visualizer" aria-hidden="true">
      <span></span><span></span><span></span><span></span><span></span>
      <span></span><span></span><span></span><span></span><span></span>
    </div>
  </div>

  <div>
    <div class="title" id="title">Memuat...</div>
    <div class="artist" id="artist"></div>
  </div>

  <div class="controls" role="group" aria-label="Kontrol audio">
    <button id="shuffle" class="btn" title="Shuffle">üîÄ</button>
    <button id="prev" class="btn" title="Previous">‚èÆÔ∏è</button>
    <button id="play" class="big" title="Play">‚ñ∂Ô∏è</button>
    <button id="next" class="btn" title="Next">‚è≠Ô∏è</button>
    <button id="repeat" class="btn" title="Repeat">üîÅ</button>
  </div>

  <div class="row">
    <div class="volume-container">
      <button id="mute" class="btn" title="Mute">üîä</button>
      <input id="volume" type="range" min="0" max="1" step="0.01" />
    </div>
    <div id="rateDisplay">1.0</div>
  </div>

  <div class="row" style="align-items:center;">
    <div class="time" id="curTime">0:00.0</div>
    <div class="progress" id="progress" aria-label="progress">
      <div class="bar" id="bar"></div>
    </div>
    <div class="time" id="durTime">0:00.0</div>
  </div>

  <div class="playlist-wrap">
    <div class="playlist" id="playlist" role="list"></div>
  </div>
</div>

<div class="bg-text">MUSIC NET</div>
<div class="page-footer">Created By Afrizal In October 2025 <br> 
<span class="version">Copyright &copy; 2025 Music Net Player</span>
</div>


<audio id="audio" crossorigin="anonymous"></audio>

<script>
/* ------------------------
   Background canvas & audio visualizer
------------------------ */
const canvas = document.getElementById('bg');
const ctx = canvas.getContext('2d');
let W = canvas.width = innerWidth;
let H = canvas.height = innerHeight;
addEventListener('resize', ()=>{ W=canvas.width=innerWidth; H=canvas.height=innerHeight; });

const particles=[];
for(let i=0;i<120;i++){
  particles.push({ x: Math.random()*W, y: Math.random()*H, r: Math.random()*1.6+0.6, dx:(Math.random()-0.5)*0.6, dy:(Math.random()-0.5)*0.6 });
}

let audioCtx, analyser, dataArray;
function setupAudioAnalyzer(audioEl){
  if(audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const src = audioCtx.createMediaElementSource(audioEl);
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 256;
  dataArray = new Uint8Array(analyser.frequencyBinCount);
  src.connect(analyser);
  analyser.connect(audioCtx.destination);
}

let beatLevel = 0;
function draw(){
  requestAnimationFrame(draw);
  ctx.clearRect(0,0,W,H);

  if(analyser){
    analyser.getByteFrequencyData(dataArray);
    const lowCount = Math.max(4, Math.floor(dataArray.length*0.08));
    let sum=0; for(let i=0;i<lowCount;i++) sum+=dataArray[i];
    const avg = sum/lowCount/255;
    let total=0; for(let i=0;i<dataArray.length;i++) total+=dataArray[i];
    const overall = total/dataArray.length/255;
    beatLevel = Math.max(beatLevel*0.85, avg);
    window.__music_overall = overall;
  } else {
    beatLevel *= 0.92;
    window.__music_overall = Math.max(0,(window.__music_overall||0)*0.98);
  }

  const t = Date.now()*0.001;
  for(let x=0;x<W;x+=7){
    const amp = 18 + 60*beatLevel;
    const y = H/2 + Math.sin(x*0.012 + t)*amp + Math.sin(x*0.006 + t*2)*(amp*0.6);
    ctx.fillStyle = `rgba(110,240,255,${0.08 + beatLevel*0.5})`;
    ctx.fillRect(x, y, 2, 2);
  }

  const overall = window.__music_overall || 0;
  particles.forEach(p=>{
    p.x += p.dx * (1 + overall*2);
    p.y += p.dy * (1 + overall*2);
    if(p.x < -10) p.x = W + 10;
    if(p.x > W + 10) p.x = -10;
    if(p.y < -10) p.y = H + 10;
    if(p.y > H + 10) p.y = -10;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r * (1 + overall*1.5), 0, Math.PI*2);
    ctx.fillStyle = `rgba(138,79,255,${0.25 + overall*0.75})`;
    ctx.shadowBlur = 8;
    ctx.shadowColor = 'rgba(138,79,255,0.9)';
    ctx.fill();
  });

  const logo = document.getElementById('logo');
  if(logo){
    const scale = 1 + beatLevel*0.25;
    const shadow = 20 + beatLevel*40;
    logo.style.transform = `scale(${scale})`;
    logo.style.boxShadow = `0 0 ${shadow}px rgba(110,240,255,0.35), 0 0 ${shadow/2}px rgba(138,79,255,0.25)`;
  }

  const bars = document.querySelectorAll('#visualizer span');
  if(analyser && bars.length){
    for(let i=0;i<bars.length;i++){
      const v = dataArray[i*2]/255;
      bars[i].style.height = `${8 + v*28}px`;
      bars[i].style.opacity = `${0.4 + v*0.6}`;
    }
  }
}
draw();


/* ------------------------
   Player logic
------------------------ */
const playlistURL = 'playlist.json';
const audio = document.getElementById('audio');
const playBtn = document.getElementById('play');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const shuffleBtn = document.getElementById('shuffle');
const repeatBtn = document.getElementById('repeat');
const titleEl = document.getElementById('title');
const artistEl = document.getElementById('artist');
const bar = document.getElementById('bar');
const progress = document.getElementById('progress');
const curTimeEl = document.getElementById('curTime');
const durTimeEl = document.getElementById('durTime');
const playlistEl = document.getElementById('playlist');
const searchInput = document.getElementById('search');
const genreBtn = document.getElementById('genreBtn');
const genrePanel = document.getElementById('genrePanel');
const favOnlyBtn = document.getElementById('favOnly');
const toggleListBtn = document.getElementById('toggleList');
const logoEl = document.getElementById('logo');
const visualBars = document.querySelectorAll('#visualizer span');
const volumeSlider = document.getElementById('volume');
const muteBtn = document.getElementById('mute');
const rateDisplay = document.getElementById('rateDisplay');

let playlist = [];
let filteredIndexes = [];
let favorites = JSON.parse(localStorage.getItem('musicnet_favorites')||'[]');
let savedState = JSON.parse(localStorage.getItem('musicnet_last')||'{}');
let currentIndex = 0;
let isPlaying = false;
let isShuffle = false;
let isRepeat = false;
let showFavOnly = false;
let visInterval = null;

const ALLOWED_GENRES = ['pop','poprock','slow','breakbeat','cover'];
let selectedGenres = [];

/* parse genre from track tags */
function tagsToLower(arr){
  return (arr||[]).map(x=>String(x).toLowerCase().trim());
}

/* load playlist.json */
async function loadPlaylist(){
  try{
    const res = await fetch(playlistURL, {cache:'no-store'});
    if(!res.ok) throw new Error('playlist.json not found');
    playlist = await res.json();
    playlist = playlist.map(p=>{
      return {
        file: p.url || p.file || p.src || '',
        title: p.title || p.name || '',
        artist: p.artist || '',
        tags: Array.isArray(p.tags) ? tagsToLower(p.tags) : (p.tags ? tagsToLower(String(p.tags).split(',').map(s=>s.trim())) : [])
      };
    });
    buildGenrePanel();
    applyFilters();
    if(savedState && typeof savedState.index === 'number' && playlist[savedState.index]){
      currentIndex = savedState.index;
      loadTrack(currentIndex);
      if(savedState.time) audio.currentTime = savedState.time;
    } else if(playlist.length) loadTrack(0);
  }catch(err){
    console.error(err);
    titleEl.textContent = 'Gagal memuat playlist.json';
  }
}

/* build genre panel with checkboxes */
function buildGenrePanel(){
  genrePanel.innerHTML = '';
  ALLOWED_GENRES.forEach(g=>{
    const label = document.createElement('label');
    label.className = 'genre-chip';
    const cb = document.createElement('input');
    cb.type = 'checkbox';
    cb.value = g;
    cb.checked = selectedGenres.includes(g);
    cb.addEventListener('change', ()=> toggleGenre(g, cb.checked));
    label.appendChild(cb);
    label.appendChild(document.createTextNode(' ' + g));
    genrePanel.appendChild(label);
  });
}

/* toggle genre selection */
function toggleGenre(g, checked){
  if(checked){
    if(!selectedGenres.includes(g)) selectedGenres.push(g);
  } else {
    selectedGenres = selectedGenres.filter(x=>x!==g);
  }
  applyFilters();
}

/* apply filters: search, genre, favorites */
function applyFilters(){
  const q = (searchInput.value||'').trim().toLowerCase();
  playlistEl.innerHTML = '';
  filteredIndexes = [];
  playlist.forEach((t,i)=>{
    if(showFavOnly && !favorites.includes(t.file)) return;

    const cleanTags = (t.tags||[]).map(tag => tag.replace(/\[|\]/g,'').toLowerCase());
    if(selectedGenres.length && !cleanTags.some(tag => selectedGenres.includes(tag))) return;

    const searchable = ((t.title||'') + ' ' + (t.artist||'')).toLowerCase();
    if(q && !searchable.includes(q)) return;

    filteredIndexes.push(i);
  });
  filteredIndexes.forEach(i => createListItem(i));
}

/* create list item */
function createListItem(i){
  const t = playlist[i];
  const row = document.createElement('div');
  row.className = 'item';
  row.dataset.i = i;
  if(i === currentIndex) row.classList.add('active');

  const meta = document.createElement('div'); meta.className = 'meta';
  const tt = document.createElement('div'); tt.className = 't'; tt.textContent = t.title || 'Tanpa Judul';
  const aa = document.createElement('div'); aa.className = 'a'; aa.textContent = t.artist || '';
  meta.appendChild(tt); meta.appendChild(aa);

  const fav = document.createElement('div'); fav.className = 'fav'; fav.textContent = favorites.includes(t.file) ? '‚òÖ' : '‚òÜ';
  if(favorites.includes(t.file)) fav.classList.add('active');

  row.appendChild(meta);
  row.appendChild(fav);

  row.addEventListener('click', (ev) => {
    if(ev.target === fav || ev.target.classList.contains('fav')){
      toggleFavorite(t.file, fav);
      ev.stopPropagation();
      return;
    }
    currentIndex = i;
    loadTrack(currentIndex);
    playAudio();
  });

  playlistEl.appendChild(row);
}

/* toggle favorite */
function toggleFavorite(file, dom){
  if(favorites.includes(file)){
    favorites = favorites.filter(f => f !== file);
    dom.textContent = '‚òÜ';
    dom.classList.remove('active');
  } else {
    favorites.push(file);
    dom.textContent = '‚òÖ';
    dom.classList.add('active');
  }
  localStorage.setItem('musicnet_favorites', JSON.stringify(favorites));
}

/* load track */
function loadTrack(i){
  if(!playlist[i]) return;
  currentIndex = i;
  const t = playlist[i];
  audio.src = t.file;
  titleEl.textContent = t.title || 'Tanpa Judul';
  artistEl.textContent = t.artist || '';
  document.querySelectorAll('.item').forEach(el => el.classList.toggle('active', Number(el.dataset.i) === i));
  saveLast();
}

/* ------------------------
   Play / Pause
------------------------ */
function playAudio(){
  try{ if(!audioCtx) setupAudioAnalyzer(audio); }catch(e){ console.warn(e) }
  audio.play().catch(()=>{});
  isPlaying = true;
  playBtn.textContent = '‚è∏Ô∏è';
  logoEl.style.animationPlayState = 'running';
  startVisualizer();
}
function pauseAudio(){
  audio.pause();
  isPlaying = false;
  playBtn.textContent = '‚ñ∂Ô∏è';
  logoEl.style.animationPlayState = 'paused';
  stopVisualizer();
}
playBtn.addEventListener('click', ()=> isPlaying ? pauseAudio() : playAudio());


/* ------------------------
   Volume / Mute
------------------------ */
let lastVolume = 1;
audio.volume = volumeSlider.value || 1;

// slider volume
volumeSlider.addEventListener('input', (e)=>{
  audio.volume = e.target.value;
  if(audio.volume === 0){
    muteBtn.textContent = 'üîá';
  } else {
    muteBtn.textContent = 'üîä';
    lastVolume = audio.volume;
  }
});

// tombol mute
muteBtn.addEventListener('click', ()=>{
  if(audio.volume > 0){
    lastVolume = audio.volume;
    audio.volume = 0;
    volumeSlider.value = 0;
    muteBtn.textContent = 'üîá';
  } else {
    audio.volume = lastVolume || 0.8;
    volumeSlider.value = audio.volume;
    muteBtn.textContent = 'üîä';
  }
});


/* ------------------------
   Prev / Next
------------------------ */
prevBtn.addEventListener('click', ()=>{
  if(audio.currentTime > 3){ audio.currentTime = 0; return; }
  currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
  loadTrack(currentIndex);
  playAudio();
});
nextBtn.addEventListener('click', ()=> nextTrack());

function nextTrack(){
  if(isRepeat){
    audio.currentTime = 0;
    playAudio();
    return;
  }
  if(isShuffle) currentIndex = Math.floor(Math.random() * playlist.length);
  else currentIndex = (currentIndex + 1) % playlist.length;
  loadTrack(currentIndex);
  playAudio();
}

/* ------------------------
   Shuffle / Repeat toggles
------------------------ */
shuffleBtn.addEventListener('click', ()=> { isShuffle = !isShuffle; shuffleBtn.classList.toggle('active', isShuffle); });
repeatBtn.addEventListener('click', ()=> { isRepeat = !isRepeat; repeatBtn.classList.toggle('active', isRepeat); });

/* ------------------------
   Save last track/time
------------------------ */
function saveLast(){
  try{
    localStorage.setItem('musicnet_last', JSON.stringify({ index: currentIndex, time: audio.currentTime || 0 }));
  }catch(e){}
}

/* ------------------------
   Toolbar interactions
------------------------ */
searchInput.addEventListener('input', applyFilters);
favOnlyBtn.addEventListener('click', ()=>{
  showFavOnly = !showFavOnly;
  favOnlyBtn.classList.toggle('active', showFavOnly);
  applyFilters();
});

/* ------------------------
   Hide / Show playlist
------------------------ */
toggleListBtn.addEventListener('click', ()=>{
  const wrap = document.querySelector('.playlist-wrap');
  if(wrap){
    const isHidden = wrap.classList.toggle('hidden');
    toggleListBtn.textContent = isHidden ? '‚ñº' : '‚ñ≤';
  }
});

/* ------------------------
   Genre panel open/close
------------------------ */
genreBtn.addEventListener('click', (ev)=>{
  const open = genrePanel.style.display !== 'none';
  genrePanel.style.display = open ? 'none' : 'flex';
  genreBtn.setAttribute('aria-expanded', (!open).toString());
});
document.addEventListener('click', (ev)=>{
  if(!genrePanel.contains(ev.target) && ev.target !== genreBtn){
    genrePanel.style.display = 'none';
    genreBtn.setAttribute('aria-expanded','false');
  }
});

/* ------------------------
   Progress bar update
------------------------ */
function formatTime(sec){
  const m = Math.floor(sec / 60);
  const s = Math.floor(sec % 60);
  return `${m}:${s<10?'0'+s:s}`;
}

function updateProgress(){
  if(!audio || !bar || !curTimeEl || !durTimeEl) return;
  if(audio.duration){
    const pct = (audio.currentTime / audio.duration) * 100;
    bar.style.width = pct + '%';
    curTimeEl.textContent = formatTime(audio.currentTime);
    durTimeEl.textContent = formatTime(audio.duration);
  }
}

audio.addEventListener('timeupdate', updateProgress);

// klik di progress untuk lompat
progress.addEventListener('click', (e)=>{
  if(!audio.duration) return;
  const rect = progress.getBoundingClientRect();
  const clickX = e.clientX - rect.left;
  const newTime = (clickX / rect.width) * audio.duration;
  audio.currentTime = newTime;
  updateProgress();
});

// drag untuk lebih smooth
let isDragging = false;
progress.addEventListener('mousedown', ()=> isDragging = true);
progress.addEventListener('mouseup', ()=> isDragging = false);
progress.addEventListener('mousemove', (e)=>{
  if(!isDragging || !audio.duration) return;
  const rect = progress.getBoundingClientRect();
  const moveX = e.clientX - rect.left;
  const newTime = Math.max(0, Math.min(1, moveX / rect.width)) * audio.duration;
  audio.currentTime = newTime;
  updateProgress();
});

/* ------------------------
   Audio ended -> next
------------------------ */
audio.addEventListener('ended', ()=> nextTrack());

/* ------------------------
   Initial load
------------------------ */
loadPlaylist();
</script>
</body>
</html>
